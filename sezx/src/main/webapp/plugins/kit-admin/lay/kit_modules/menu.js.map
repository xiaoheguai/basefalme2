{"version":3,"sources":["menu.js"],"names":["layui","define","exports","$","jquery","utils","_","lodash","axios","storage","this","Menu","undefined","dynamicRender","elem","onClicked","data","url","method","isJump","cached","MENU","MENU_ITEM","THIS","set","options","extend","config","prototype","render","that","length","setItem","cacheKey","_private","renderHTML","bind","isHandled","getItem","loadData","remote","each","className","_item","_a","isOneLevel","find","addClass","hasChild","attr","layid","randomCode","e","hasClass","siblings","removeClass","off","on","stope","isFunction","removeCache","key","removeItem","callback","temps","recursion","_elem","push","error","join","temp","datas","pid","curr","item","index","forEach","open","path","blank","href","icon","title","children","res","status","Error","statusText","catch"],"mappings":";cAAAA,MAAMC,OAAO,CAAC,SAAU,QAAS,SAAU,SAAUC,GACnD,IAAIC,EAAIH,MAAMI,OADhBJ,EAAAA,MAAcK,MAAkDC,EAAAN,MAAAO,OAC9DC,EAAQR,MAAMI,MAAdK,EACUT,EAAMK,aACdC,EAAIN,WAFNU,KAGEF,OAAQR,CACRS,UAAAA,EACEE,eAAOC,EACTC,eAAc,EACZC,KAAMF,GACNG,OAAAA,CACAF,SAAAA,EACAG,OAAU,OAERC,QAAKL,EACLM,SAAQ,eAFFC,QALI,EASZC,SAAQ,GAERD,KAAAA,QAXY,SAAdE,EAAA,YAcAC,EAAA,iBAEFX,EAGEY,UAAOC,IAAA,SAHTC,GAMAd,OADAR,EAAAuB,QAAA,EADShB,KACTiB,OAAAF,GADSf,MAKPC,EAAAiB,UAAAC,OAAA,WAHF,IAAAC,EAAApB,KAKAiB,EAAAG,EAAAH,OAEE,GAAIG,EAAOjB,cAEX,GAAA,EAAAc,EAAAX,KAAAe,OAEEtB,EAAAuB,QAAAL,EAAAM,SAAAjB,GAEEkB,EAAAC,WAAAR,EAAAb,KAAAa,EAAAX,KAAA,WAEAc,EAAAM,aAEE,CAED,IAHDC,GAAA,EAJF,GAAAV,EAQOP,OAAA,CACL,IAAAJ,EAAAP,EAAA6B,QAAAX,EAAAM,UACII,MAAAA,IACAV,GAAOP,EACTc,EAAWzB,WAAQ6B,EAAQX,KAAOM,EAAAA,WAC9BjB,EAAAA,UAEFqB,GAIHH,EAAAK,SAAAZ,EAAAa,OAAA,SAAAxB,GAECP,EAAAuB,QAAAL,EAAAM,SAAAjB,GAEEkB,EAAAC,WAAAR,EAAAb,KAAAE,EAAA,WACAP,EAAAA,gBAOLqB,EAAAM,OAED,OAAAN,GAGFnB,EAAAiB,UAAAQ,KAAA,WA1CF,IA4CAT,EA5CAjB,KA4CAiB,OAiDO,OAhDPhB,EAAAA,GAAKiB,KAAUQ,GAAOK,KAAA,WACpB,IAAIX,EAAO3B,EAAXO,MACEiB,EAAAA,EAASG,SADX,KAEyC,aAA5BR,EAAWmB,SAAK,GAAAC,WAE3BC,EAAIC,KAAKD,WAAe,GAExB,IAAIE,EAAY,EAAhBF,EAAgBG,KAAA,qBAAAf,OACdY,GACDC,EAAAG,SAAA,SAED,IAAIC,EAAJL,EAAcM,KAAA,UACA,KAAZL,QAAAhC,IAAYsC,IACbA,EAAA7C,EAAA8C,aACDR,EAAIO,KAAQP,SAAWO,IAErBA,EAAAA,IAAAA,SAAcC,GAAAA,QAAd,SAAAC,GAwBQ,GAvBRT,MAAMM,MAAKG,GACZJ,GAIK3B,EAAMyB,SAAKxB,cACbqB,EAAMI,YAAS,cAEfJ,EAAIA,SAAMU,cAGRV,EAAMI,SACPJ,EAAAM,KAAA,YACDN,EAAAW,WAAAC,YAAA,gBAXDC,EAAHnC,GAAOyB,KAASW,GAAYF,YAAA,cAC1BvD,EAAM0D,SAAN,eAcKrD,EAAAsD,WAAAhC,EAAAZ,YAAAY,EAAAZ,UAAA,CACFD,KAAA6B,EACFK,SAAAA,EACD3C,KAAMsD,CACJ7C,KAAM6B,EAD+CM,KAAA,QAErDD,MAAAA,MACMrB,EAAAR,OAHR,OAAA,MAlFNT,MAgGEC,EAAAiB,UAAAgC,YAAA,SAAAC,GAnDF,IAqDAlC,EArDAjB,KAqDAiB,OACAhB,EAAKiB,GAAUgC,EAAAA,SACbvD,EAAIyB,aAAJgC,WAAAD,IAID,IALD3B,EAAA,CAOAC,WAAA,SAAArB,EAAAE,EAAA+C,GACI7B,IACF8B,EAAA,CAAA,yBAOE,GARWtD,KAIPsD,UAASA,EAAAhD,EADTc,GAKe,EAAfkC,EAAMjC,OAAY,CADtBD,EAAKmC,KAAAA,SACL,IAAID,EAAMjC,EAANjB,GACF,GAAA,IAAAoD,EAAAnC,OAEA,YADAiC,EAAMG,MAAK,gCAGT9D,EAAAA,KAAM+D,EAAMC,KAAA,KACZhE,EAAAsD,WAAAI,IAAAA,MAIHE,UAAA,SAAAK,EAAAC,EAAAC,GAlBU,IAAA1C,EAAApB,KAoBb+D,EAAA,GACAR,EAAAA,QAAWM,EAAA,SAAAG,EAAAC,GACL7C,EAAO0C,MAAXA,GACIC,EAAAA,KAAJC,KAEM,EAAJD,EAAIC,QADNpE,EAAAsE,QAAAH,EAAA,SAAAC,GAIID,IAAAA,EAAAC,EAAJG,KAAqB,aAAA,GACjBD,EAAAA,KAAQH,4BAAsBI,EAAA,MAC9B,IAAIA,EAAOH,EAAAA,QAAAA,EAAYI,MAAA,eAAvBJ,EAAAI,KACAR,EAAAS,MACAT,EAAIU,KAAO1E,YAAewE,EAAf,sBAETR,EAAKH,KAAK,YAAca,EAAO,MAE/BV,EAAAA,KAAKH,yBAALO,EAAAO,KAAA,SACDX,EAAAH,KAAA,SAAAO,EAAAQ,MAAA,WACDZ,EAAKH,KAAK,QACVG,IAAAA,EAAUI,EAAAS,SACVb,MAAAA,GAAA,EAAAa,EAAApD,SACAuC,EAAIa,KAAAA,0EACJrD,EAAIqD,UAAavE,EAAAA,EAAauE,EAAAA,IAC5Bb,EAAKH,KAAK,UAEVG,EAAAA,KAAKH,YAKZ5B,SAlDY,SAAAd,EAAAsC,GAmDbvD,EAAAiB,GACAc,KAAU,SAAA6C,GACR5E,GACQ,MADFiB,EAAAA,OAEE2D,MAAIC,IAAJC,MAAeF,EACjBG,YACF,OAAOH,EAAIpE,OAGX+C,KAAAA,SAAA/C,GAEDwE,EAAMxE,KATTwE,MAAA,SAAApB,GAYD/D,EAAA+D,MAAAA,OAMHlE,EAAQ,OADR,IAAAS","file":"menu.js","sourcesContent":["layui.define(['jquery', 'utils', 'axios'], function (exports) { //提示：模块也可以依赖其它模块，如：layui.define('layer', callback);\n  var $ = layui.jquery,\n    utils = layui.utils,\n    _ = layui.lodash,\n    axios = layui.axios,\n    storage = utils.localStorage;\n  var Menu = function () {\n    this.config = {\n      elem: undefined, // 容器\n      onClicked: undefined, // 点击后触发的回调\n      dynamicRender: false, // 是否动态渲染 --如果此参数为true,则需要设置elem,[data或者remote]参数\n      data: [], // 数据\n      remote: { //此配置请参数axios的request配置，文档地址：https://www.kancloud.cn/yunye/axios/234845\n        url: undefined,\n        method: 'get'\n      },\n      cached: false, // 是否开启缓存,注：只缓存远程加载的数据。\n      cacheKey: 'KITADMINMENU', // 缓存key\n      isJump: true, //是否直接跳转页面\n      onlyOne: true\n    };\n    this.version = '1.0.0';\n  }\n  var MENU = '.kit-menu',\n    MENU_ITEM = '.kit-menu-item',\n    MENU_CHILD = '.kit-menu-child',\n    THIS = '.layui-this',\n    SHOW = '.layui-show';\n  // 设置参数\n  Menu.prototype.set = function (options) {\n    var that = this;\n    $.extend(true, that.config, options);\n    return that;\n  };\n  // 渲染\n  Menu.prototype.render = function () {\n    var that = this,\n      config = that.config;\n    // 是否需要动态渲染\n    if (config.dynamicRender) {\n      //本地数据优先级最高\n      if (config.data.length > 0) {\n        // 缓存数据\n        storage.setItem(config.cacheKey, data);\n        // 渲染DOM\n        _private.renderHTML(config.elem, config.data, function () {\n          // 绑定事件\n          that.bind();\n        });\n      } else {\n        //是否已经处理\n        var isHandled = false;\n        if (config.cached) {\n          var data = storage.getItem(config.cacheKey);\n          if (data !== null && data !== undefined) {\n            isHandled = true;\n            _private.renderHTML(config.elem, data, function () {\n              that.bind();\n            });\n          }\n        }\n        if (!isHandled) {\n          // 远程读取\n          _private.loadData(config.remote, function (data) {\n            // 缓存数据\n            storage.setItem(config.cacheKey, data);\n            // 渲染DOM\n            _private.renderHTML(config.elem, data, function () {\n              that.bind();\n            });\n          });\n        }\n      }\n    } else {\n      //绑定事件\n      that.bind();\n    }\n    return that;\n  };\n  // 绑定事件\n  Menu.prototype.bind = function () {\n    var that = this,\n      config = that.config;\n    $(MENU).find(MENU_ITEM).each(function () {\n      var _item = $(this);\n      var _a = _item.children('a');\n      var isOneLevel = _item.parent()[0].className === 'kit-menu';\n      if (isOneLevel) {\n        _item.attr('lay-one', true);\n      }\n      var hasChild = _item.find('ul.kit-menu-child').length > 0;\n      if (hasChild) {\n        _a.addClass('child');\n      }\n      var layid = _item.attr('lay-id');\n      if (layid === '' || layid === undefined) {\n        layid = utils.randomCode();\n        _item.attr('lay-id', layid);\n      }\n      _a.off('click').on('click', function (e) {\n        layui.stope(e);\n        if (!hasChild) {\n          $(MENU).find(MENU_ITEM).removeClass('layui-this');\n          _item.addClass('layui-this');\n        } else {\n          if (_item.hasClass('layui-show')) {\n            _item.removeClass('layui-show');\n          } else {\n            _item.addClass('layui-show');\n          }\n          // 只展开一个\n          if (config.onlyOne) {\n            if (_item.attr('lay-one')) {\n              _item.siblings().removeClass('layui-show');\n            }\n          }\n        }\n        utils.isFunction(config.onClicked) && config.onClicked({\n          elem: _item,\n          hasChild: hasChild,\n          data: {\n            href: _a.attr('href'),\n            layid: layid\n          }\n        });\n        // 拦截a标签的跳转\n        if (!config.isJump) {\n          return false;\n        }\n      });\n    });\n    return that;\n  };\n  // 移除缓存\n  Menu.prototype.removeCache = function (key) {\n    var that = this,\n      config = that.config;\n    key = key || config.cacheKey;\n    utils.localStorage.removeItem(key);\n  };\n\n  // 私有方法\n  var _private = {\n    // 渲染HTML\n    renderHTML: function (elem, data, callback) {\n      var that = this;\n      var temps = ['<ul class=\"kit-menu\">'];\n\n      var pid = 0; //一级菜单pid为0 ，这是一个约定\n      that.recursion(temps, data, pid);\n      if (temps.length > 0) {\n        // 闭合ul\n        temps.push('</ul>');\n        var _elem = $(elem);\n        if (_elem.length === 0) {\n          utils.error('Menu config error:请配置elem参数.');\n          return;\n        }\n        _elem.html(temps.join(''));\n        utils.isFunction(callback) && callback();\n      }\n    },\n    // 递归组装dom\n    recursion: function (temp, datas, pid) {\n      var that = this;\n      var curr = [];\n      _.forEach(datas, function (item, index) {\n        if (item.pid === pid)\n          curr.push(item);\n      });\n      if (curr.length > 0) {\n        _.forEach(curr, function (item) {\n          var open = item.open ? 'layui-show' : '';\n          temp.push('<li class=\"kit-menu-item ' + open + '\">');\n          var href = _.isEmpty(item.path) ? 'javascript:;' : item.path;\n          if (item.blank) {\n            temp.push('<a href=\"' + href + '\" target=\"_blank\">');\n          } else {\n            temp.push('<a href=\"' + href + '\">');\n          }\n          temp.push('<i class=\"layui-icon\">' + item.icon + '</i> ');\n          temp.push('<span>' + item.title + '</span>');\n          temp.push('</a>');\n          var children = item.children;\n          if (children !== undefined && children !== null && children.length > 0) {\n            temp.push('<ul class=\"kit-menu-child kit-menu-child layui-anim layui-anim-upbit\">');\n            that.recursion(temp, children, item.id);\n            temp.push('</ul>');\n          }\n          temp.push('</li>');\n        });\n      }\n    },\n    // 远程加载数据\n    loadData: function (options, callback) {\n      axios(options)\n        .then(function (res) {\n          if (res.status === 500)\n            throw new Error(res.statusText);\n          return res.data;\n        })\n        .then(function (data) {\n          callback(data);\n        })\n        .catch(function (error) {\n          utils.error(error);\n        });\n    }\n  };\n\n  var menu = new Menu();\n\n  //输出menu接口\n  exports('menu', menu);\n});"]}