{"version":3,"sources":["route.js"],"names":["layui","define","exports","utils","localStorage","setItem","getItem","$","_","layer","jquery","_win","undefined","_viewBoxGlobal","this","config","Route","routerViewId","name","routes","prototype","set","options","setRoutes","that","defaults","forEach","item","extend","getTime","random","window","off","on","onChanged","getRoutes","getRoute","hash","router","location","route","r","href","split","c","component","length","path","render","renderTarget","callback","_viewBox","NProgress","loadIndex","load","start","randomCode","_view","parent","append","viewId","remove","done","close","isFunction","cb","beforeRender","h","currBoxHeight","height","join","data","html","errorMsg","p","params","value","substr","indexOf","index","kv","key"],"mappings":"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","file":"route.js","sourcesContent":["layui.define(['utils', 'jquery', 'lodash', 'nprogress', 'layer'], function(exports) {\n  var utils = layui.utils,\n    localStorage = utils.localStorage,\n    setItem = localStorage.setItem,\n    getItem = localStorage.getItem,\n    $ = layui.jquery,\n    _ = layui.lodash,\n    layer = layui.layer,\n    _win = $(window);\n\n  var _viewBoxGlobal = undefined;\n\n  var Route = function() {\n    this.config = {\n      name: 'KITADMINROUTE', // 这个不能改，可能会出问题。\n      routerViewId: undefined,\n      beforeRender: undefined,\n      routes: []\n    };\n    this.version = '1.2.1';\n  };\n  /**\n   * 设置\n   * @param {Object} options \n   */\n  Route.prototype.set = function(options) {\n    var that = this;\n    $.extend(true, that.config, options);\n    return that;\n  };\n  /**\n   * 设置路由\n   * @param {*} options \n   */\n  Route.prototype.setRoutes = function(options) {\n    var that = this;\n    options.name = options.name || that.config.name;\n    that.config.name = options.name;\n    var defaults = {\n      routes: []\n    };\n    $.extend(true, defaults, options);\n    _.forEach(defaults.routes, function(item) {\n      item.id = new Date().getTime() + '' + _.random(1000, 9999);\n    });\n    // 缓存到本地\n    setItem(defaults.name, defaults.routes);\n    $(window).off('popstate').on('popstate', function() {\n      // 是否由外部处理\n      if (utils.isFunction(options.onChanged)) {\n        options.onChanged();\n      } else {\n        that.render();\n      }\n    });\n    return that;\n  };\n  /**\n   * 获取路由\n   */\n  Route.prototype.getRoutes = function() {\n    return getItem(this.config.name);\n  };\n  /**\n   * 获取路由信息\n   * @param {*} hash \n   */\n  Route.prototype.getRoute = function(hash) {\n    var that = this;\n    var routes = that.getRoutes(that.config.name);\n    if (routes === null || routes === undefined) {\n      return undefined;\n    }\n    hash = hash || location.hash;\n    var route = layui.router(hash);\n    var href = route.href.split('?');\n    var c = utils.find(routes, function(r) {\n      return r.path === href[0];\n    })\n    if (href.length > 1) {\n      c.component += '?' + href[1];\n      c.path += '?' + href[1];\n    }\n    return c;\n  };\n  /**\n   * 渲染页面\n   * @param {*} hash \n   * @param {*} renderTarget \n   * @param {*} callback \n   */\n  Route.prototype.render = function(hash, renderTarget, callback) {\n    var that = this,\n      config = that.config,\n      _viewBox = undefined;\n    // 开始\n    NProgress.start();\n    var loadIndex = layer.load(2);\n    var viewId = utils.randomCode();\n    if (renderTarget && renderTarget.length > 0) {\n      _viewBox = renderTarget;\n    } else {\n      var _view = config.routerViewId === undefined ?\n        $('router-view') : $('router-view#' + config.routerViewId + '');\n      // 如果 router-view 标签存在都创建渲染dom,覆盖原来的\n      if (_view.length > 0) {\n        // 获取id\n        _view.parent().append('<div id=\"' + viewId + '\"></div>');\n        _view.remove();\n        _viewBox = $('#' + viewId);\n        _viewBoxGlobal = _viewBox; //缓存一个全局容器 避免单页面的时候 _viewBox 为 undefined\n      }\n    }\n    // 如果是单页面则读取全局\n    if (_viewBox === undefined) {\n      _viewBox = _viewBoxGlobal;\n    }\n    var route = that.getRoute(hash);\n    var notFoundTpl = [\n      '<div class=\"layui-fluid\">',\n      '  <div class=\"layui-row\">',\n      '    <div class=\"layui-col-xs12\">',\n      '      <div class=\"layui-row\">',\n      '        <div class=\"layui-col-md4\">&nbsp;</div>',\n      '        <div class=\"layui-col-md4\">',\n      '          <div class=\"kit-exception\">',\n      '            <i class=\"layui-icon kit-exception-icon\">&#xe61c;</i>',\n      '            <h3 class=\"kit-exception-title\">:>404 抱歉，你访问的页面不存在</h3>',\n      '            <a href=\"javascript:history.back(-1);\" class=\"layui-btn\">返回上一页</a>',\n      '          </div>',\n      '        </div>',\n      '        <div class=\"layui-col-md4\">&nbsp;</div>',\n      '      </div>',\n      '    </div>',\n      '  </div>',\n      '</div>'\n    ];\n    if (route !== undefined) {\n      if (typeof config.beforeRender === 'function') {\n        route = config.beforeRender(route);\n      }\n      // 如果是iframe\n      if (route.iframe) {\n        // _viewBox.html('<div class=\"kit-body-wapper\"><iframe src=\"' + route.component + '\" style=\"height: 780px;\"></iframe></div>');\n        _viewBox.html('<iframe src=\"' + route.component + '\" data-id=\"' + viewId + '\" style=\"height: 780px;\"></iframe>');\n        // 自适应高度\n        _win.on('resize', function() {\n          var currBoxHeight = $('.layui-body').height(); //获取当前容器的高度\n          $('iframe[data-id=' + viewId + ']').height(currBoxHeight - 3);\n        }).resize();\n\n        cb();\n      } else {\n        utils.tplLoader(route.component, function(data) {\n          _viewBox.html(data);\n          cb();\n          // 设置浏览器地址显示\n          utils.setUrlState(route.name, '#' + route.path);\n        }, function(errorMsg) {\n          var h = [\n            '<div class=\"layui-fluid\">',\n            '<div class=\"layui-row\">',\n            '<div class=\"layui-col-xs12\">',\n            '<div class=\"kit-not-router\">',\n            errorMsg,\n            '</div>',\n            '</div>',\n            '</div>',\n            '</div>'\n          ].join('');\n          _viewBox.html(h);\n          cb();\n        });\n      }\n    } else {\n      _viewBox.html(notFoundTpl.join(''));\n      NProgress.done();\n      loadIndex && layer.close(loadIndex);\n    }\n\n    function cb() {\n      // 结束\n      NProgress.done();\n      loadIndex && layer.close(loadIndex);\n      utils.isFunction(callback) && callback();\n    }\n    return that;\n  };\n  /**\n   * 获取路由参数\n   */\n  Route.prototype.params = function() {\n    var router = layui.router();\n    if (router.href === undefined) return null;\n    var href = router.href;\n    var p = href.substr(href.indexOf('?') + 1);\n    if (href === p) return null;\n    var params = p.split('&');\n    var data = {};\n    _.forEach(params, function(item, index) {\n      var kv = item.split('=');\n      var key = kv[0];\n      var value = kv[1];\n      data[key] = value;\n    });\n    return data;\n  };\n  var route = new Route();\n  //输出router接口\n  exports('route', route);\n});"]}